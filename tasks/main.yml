---
# tasks file for python_pip
- name: install software
  package:
    name: "{{ item }}"
  with_items:
    - "{{ python_pip_packages[ansible_distribution ~ '-' ~ ansible_distribution_major_version]
      | default(python_pip_packages[ansible_distribution]
      | default(python_pip_packages['default'] )) }}"

- name: configure system to load python27 variables
  copy:
    src: /opt/rh/python27/enable
    dest: /etc/profile.d/python27.sh
    remote_src: yes
  when:
    - ansible_distribution == "CentOS"
    - ansible_distribution_major_version == "6"

- name: configure dynamic linker to use python27
  copy:
    dest: /etc/ld.so.conf.d/python27-x86_64.conf
    content: "/opt/rh/python27/root/usr/lib64"
  notify:
    - ldconfig

- name: link binaries in path
  file:
    src: /opt/rh/python27/root/usr/bin/{{ item }}
    dest: /usr/bin/{{ item }}
    state: link
  with_items:
    - pip

- name: flush handlers
  meta: flush_handlers

- name: update pip
  pip:
    name: pip
    version: "{{ python_pip_version }}"
  register: update_pip
  until: update_pip is succeeded
  retries: 3

- name: update setuptools
  pip:
    name: setuptools
    version: "{{ python_pip_setuptools_version }}"
  register: update_setuptools
  until: update_setuptools is succeeded
  retries: 3

- name: install requested modules
  pip:
    name: "{{ item.name }}"
    version: "{{ item.version | default(omit) }}"
  with_items:
    - "{{ python_pip_modules }}"
  register: install_requested_modules
  until: install_requested_modules is succeeded
  retries: 3
